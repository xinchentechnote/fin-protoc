package parser

import (
	"strings"

	"github.com/iancoleman/strcase"
	"github.com/xinchentechnote/fin-protoc/internal/model"
)

// PythonGenerator a go code generator
type PythonGenerator struct {
	config   *GeneratorConfig
	binModel *model.BinaryModel
}

// NewPythonGenerator new
func NewPythonGenerator(config *GeneratorConfig, binModel *model.BinaryModel) *PythonGenerator {
	return &PythonGenerator{
		config:   config,
		binModel: binModel,
	}
}

// Generate go code
func (g PythonGenerator) Generate(binModel *model.BinaryModel) (map[string][]byte, error) {
	output := make(map[string][]byte)
	for _, pkt := range binModel.PacketsMap {
		code := g.generateGoFileForPacket(&pkt)
		output[strcase.ToSnake(pkt.Name)+".go"] = []byte(code)
	}
	return output, nil
}

func (g PythonGenerator) generateGoFileForPacket(_ *model.Packet) string {
	var b strings.Builder

	b.WriteString("// Code generated by fin-protoc. DO NOT EDIT.\n")

	return b.String()
}
