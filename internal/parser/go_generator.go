package parser

import (
	"strings"

	"github.com/iancoleman/strcase"
	"github.com/xinchentechnote/fin-protoc/internal/model"
)

// GoGenerator a go code generator
type GoGenerator struct {
	config   *GeneratorConfig
	binModel *model.BinaryModel
}

// NewGoGenerator new
func NewGoGenerator(config *GeneratorConfig, binModel *model.BinaryModel) *GoGenerator {
	return &GoGenerator{
		config:   config,
		binModel: binModel,
	}
}

// Generate go code
func (g GoGenerator) Generate(binModel *model.BinaryModel) (map[string][]byte, error) {
	output := make(map[string][]byte)
	for _, pkt := range binModel.PacketsMap {
		code := g.generateGoFileForPacket(&pkt)
		output[strcase.ToSnake(pkt.Name)+".go"] = []byte(code)
	}
	return output, nil
}

func (g GoGenerator) generateGoFileForPacket(pkt *model.Packet) string {
	var b strings.Builder

	b.WriteString("// Code generated by fin-protoc. DO NOT EDIT.\n")

	return b.String()
}
